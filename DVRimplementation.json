{
  "dvr_implementation": {
    "description": "Overview of the DVR recording and rule execution API.",
    "endpoints": {
      "series_rules": {
        "description": "Manage EP-based 'Season Pass' auto-recording rules. These rules bind to a specific EPG ID (tvg_id) and optionally filtering by program title.",
        "base_url": "/api/channels/series-rules/",
        "endpoints": [
          {
            "method": "GET",
            "url": "/api/channels/series-rules/",
            "description": "List all configured series recording rules.",
            "response": {
              "rules": [
                {
                  "tvg_id": "string (The EPG/XMLTV ID)",
                  "title": "string (Series Title Filter - Optional)",
                  "mode": "string ('all' or 'new')"
                }
              ]
            }
          },
          {
            "method": "POST",
            "url": "/api/channels/series-rules/",
            "description": "Create or update a rule. Triggers immediate evaluation.",
            "payload": {
              "tvg_id": "string (Required)",
              "title": "string (Optional - if omitted, records ALL shows on channel)",
              "mode": "string ('all' or 'new', default: 'all')"
            },
            "response": {
              "success": true,
              "rules": ["...updated list of rules..."]
            }
          },
          {
            "method": "DELETE",
            "url": "/api/channels/series-rules/{tvg_id}/",
            "description": "Delete a rule by its EPG ID.",
            "response": {
              "success": true,
              "rules": ["...remaining rules..."]
            }
          },
          {
            "method": "POST",
            "url": "/api/channels/series-rules/evaluate/",
            "description": "Manually trigger evaluation of all or specific series rules.",
            "payload": {
              "tvg_id": "string (Optional - evaluate only this ID)"
            },
            "response": {
              "success": true,
              "scheduled": "integer (number of new recordings created)",
              "details": [{"tvg_id": "...", "status": "..."}]
            }
          },
          {
            "method": "POST",
            "url": "/api/channels/series-rules/bulk-remove/",
            "description": "Bulk delete scheduled recordings associated with a rule.",
            "payload": {
              "tvg_id": "string (Required)",
              "title": "string (Optional)",
              "scope": "string ('title' or 'channel', default: 'title')"
            },
            "response": {
              "success": true,
              "removed": "integer"
            }
          }
        ]
      },
      "recurring_rules": {
        "description": "Manage manual repeating time-slots (e.g., 'Record Channel 5 every Mon/Fri at 8 PM').",
        "base_url": "/api/channels/recurring-rules/",
        "schema": {
          "channel": "integer (Channel ID)",
          "days_of_week": "array of integers [0-6] (0=Monday, 6=Sunday)",
          "start_time": "string (HH:MM:SS)",
          "end_time": "string (HH:MM:SS)",
          "enabled": "boolean (default: true)",
          "name": "string (Optional label)",
          "start_date": "string (YYYY-MM-DD, Required - valid from)",
          "end_date": "string (YYYY-MM-DD, Required - valid until)"
        },
        "endpoints": [
          {
            "method": "GET",
            "url": "/api/channels/recurring-rules/",
            "description": "List all recurring rules."
          },
          {
            "method": "POST",
            "url": "/api/channels/recurring-rules/",
            "description": "Create a new recurring rule. Automatically schedules upcoming recordings.",
            "payload": { "$ref": "#/schema" }
          },
          {
            "method": "PUT/PATCH",
            "url": "/api/channels/recurring-rules/{id}/",
            "description": "Update a rule. If enabled=false, purges associated future recordings.",
            "payload": { "$ref": "#/schema" }
          },
          {
            "method": "DELETE",
            "url": "/api/channels/recurring-rules/{id}/",
            "description": "Delete a rule and purge its future recordings."
          }
        ]
      },
      "recordings": {
        "description": "Manage individual recording items (scheduled, recording, or completed).",
        "base_url": "/api/channels/recordings/",
        "schema": {
          "channel": "integer (Channel ID)",
          "start_time": "string (ISO 8601 DateTime)",
          "end_time": "string (ISO 8601 DateTime)",
          "custom_properties": {
            "program": {
              "id": "integer (ProgramData ID)",
              "title": "string",
              "tvg_id": "string"
            },
            "file_path": "string (Absolute path to local file)",
            "file_name": "string"
          }
        },
        "endpoints": [
          {
            "method": "GET",
            "url": "/api/channels/recordings/",
            "description": "List all recordings."
          },
          {
            "method": "POST",
            "url": "/api/channels/recordings/",
            "description": "Manually schedule a single recording.",
            "payload": { "$ref": "#/schema" }
          },
          {
            "method": "GET",
            "url": "/api/channels/recordings/{id}/file/",
            "description": "Stream the recorded file (supports HTTP Range requests for seeking)."
          },
          {
            "method": "POST",
            "url": "/api/channels/recordings/{id}/comskip/",
            "description": "Trigger commercial detection (comskip) for this recording.",
            "response": { "success": true, "queued": true }
          },
          {
            "method": "DELETE",
            "url": "/api/channels/recordings/{id}/",
            "description": "Delete a recording. Removes the database entry, deletes the file from disk, and kills any active connection if currently recording."
          },
          {
            "method": "POST",
            "url": "/api/channels/recordings/bulk-delete-upcoming/",
            "description": "Cancel ALL future recordings.",
            "response": { "success": true, "removed": "integer" }
          }
        ]
      }
    }
  }
}
